"""Generated Flask app for test.

Auto-generated by Garuda GLang App Builder.
Run: flask run --port 47669
"""

from flask import Flask, render_template, request, jsonify
import requests
import json

app = Flask(__name__)

GARUDA_URL = "http://127.0.0.1:3000"


@app.route("/")
def index():
    return render_template("index.html")


@app.route("/api/proxy/execute", methods=["POST"])
def proxy_execute():
    """Proxy execution requests to the Garuda instance."""
    data = request.get_json(force=True)
    try:
        resp = requests.post(
            f"{GARUDA_URL}/api/execute",
            json=data,
            timeout=60,
        )
        return jsonify(resp.json()), resp.status_code
    except requests.ConnectionError:
        return jsonify({"error": "Cannot connect to Garuda instance"}), 502


@app.route("/api/proxy/variables/<sid>")
def proxy_variables(sid):
    """Proxy variable reads to the Garuda instance."""
    try:
        resp = requests.get(f"{GARUDA_URL}/api/variables/{sid}", timeout=10)
        return jsonify(resp.json()), resp.status_code
    except requests.ConnectionError:
        return jsonify({"error": "Cannot connect to Garuda instance"}), 502


@app.route("/api/proxy/session", methods=["POST"])
def proxy_session():
    """Proxy session creation to the Garuda instance."""
    try:
        resp = requests.post(f"{GARUDA_URL}/api/session", timeout=10)
        return jsonify(resp.json()), resp.status_code
    except requests.ConnectionError:
        return jsonify({"error": "Cannot connect to Garuda instance"}), 502


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=47669, debug=True)
